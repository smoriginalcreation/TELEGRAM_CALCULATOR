<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Telegram Calculator</title>
    <!-- Telegram Web App SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            /* Default to Telegram color scheme or fallback to dark mode */
            --bg-color: var(--tg-theme-bg-color, #1c1c1e);
            --text-color: var(--tg-theme-text-color, #ffffff);
            --button-bg: var(--tg-theme-button-color, #2c2c2e);
            --button-text: var(--tg-theme-button-text-color, #ffffff);
            --secondary-bg: var(--tg-theme-secondary-bg-color, #000000);
            --accent-color: #ff9500; /* Calculator Orange */
            --function-color: #505050; /* Light Gray for top buttons */
        }

        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden; /* Prevent scrolling */
            user-select: none; /* Prevent text selection on taps */
            -webkit-tap-highlight-color: transparent;
        }

        /* Display Area */
        .display-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: flex-end;
            padding: 20px;
            background-color: var(--bg-color);
        }

        #history {
            font-size: 1.2rem;
            color: #888;
            margin-bottom: 10px;
            min-height: 1.5rem;
        }

        #display {
            font-size: 4rem;
            font-weight: 300;
            word-break: break-all;
            line-height: 1;
        }

        /* Keypad Area */
        .keypad {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            padding: 20px;
            padding-bottom: 40px; /* Extra padding for bottom safe area */
            background-color: var(--bg-color);
        }

        button {
            border: none;
            outline: none;
            font-size: 1.75rem;
            height: 75px;
            border-radius: 50%;
            cursor: pointer;
            transition: opacity 0.2s;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        button:active {
            opacity: 0.7;
        }

        /* Button Styles */
        .btn-num {
            background-color: #333333;
            color: #ffffff;
        }

        .btn-func {
            background-color: #a5a5a5;
            color: #000000;
        }

        .btn-op {
            background-color: var(--accent-color);
            color: #ffffff;
            font-size: 2rem;
            padding-bottom: 5px; /* Visual alignment for math symbols */
        }

        .btn-zero {
            grid-column: span 2;
            border-radius: 40px; /* Pill shape for zero */
            justify-content: flex-start;
            padding-left: 30px;
        }

        /* Adjust colors based on Telegram theme if available */
        body.light-mode .btn-num { background-color: #e0e0e0; color: #000; }
        body.light-mode .btn-func { background-color: #d4d4d2; }
        body.light-mode #display { color: #000; }
        body.light-mode #history { color: #555; }

    </style>
</head>
<body>

    <div class="display-container">
        <div id="history"></div>
        <div id="display">0</div>
    </div>

    <div class="keypad">
        <button class="btn-func" onclick="clearDisplay()">AC</button>
        <button class="btn-func" onclick="toggleSign()">+/-</button>
        <button class="btn-func" onclick="percentage()">%</button>
        <button class="btn-op" onclick="setOp('/')">÷</button>

        <button class="btn-num" onclick="appendNumber('7')">7</button>
        <button class="btn-num" onclick="appendNumber('8')">8</button>
        <button class="btn-num" onclick="appendNumber('9')">9</button>
        <button class="btn-op" onclick="setOp('*')">×</button>

        <button class="btn-num" onclick="appendNumber('4')">4</button>
        <button class="btn-num" onclick="appendNumber('5')">5</button>
        <button class="btn-num" onclick="appendNumber('6')">6</button>
        <button class="btn-op" onclick="setOp('-')">−</button>

        <button class="btn-num" onclick="appendNumber('1')">1</button>
        <button class="btn-num" onclick="appendNumber('2')">2</button>
        <button class="btn-num" onclick="appendNumber('3')">3</button>
        <button class="btn-op" onclick="setOp('+')">+</button>

        <button class="btn-num btn-zero" onclick="appendNumber('0')">0</button>
        <button class="btn-num" onclick="appendDot()">.</button>
        <button class="btn-op" onclick="calculate()">=</button>
    </div>

    <script>
        // --- Telegram Integration ---
        const tg = window.Telegram.WebApp;

        // Initialize App
        tg.ready();
        tg.expand(); // Requests full screen

        // Apply theme based on Telegram's color scheme
        if (tg.colorScheme === 'light') {
            document.body.classList.add('light-mode');
        }

        // --- Calculator Logic ---
        let currentInput = '0';
        let previousInput = '';
        let operation = null;
        let shouldResetDisplay = false;

        const displayEl = document.getElementById('display');
        const historyEl = document.getElementById('history');

        function updateDisplay() {
            // Format number to fit screen if too long, otherwise show as is
            if (currentInput.length > 9) {
                displayEl.innerText = parseFloat(currentInput).toPrecision(9);
            } else {
                displayEl.innerText = currentInput;
            }
        }

        function appendNumber(number) {
            if (currentInput === '0' || shouldResetDisplay) {
                currentInput = number;
                shouldResetDisplay = false;
            } else {
                currentInput += number;
            }
            updateDisplay();
        }

        function appendDot() {
            if (shouldResetDisplay) {
                currentInput = '0.';
                shouldResetDisplay = false;
            } else if (!currentInput.includes('.')) {
                currentInput += '.';
            }
            updateDisplay();
        }

        function clearDisplay() {
            currentInput = '0';
            previousInput = '';
            operation = null;
            historyEl.innerText = '';
            updateDisplay();
        }

        function toggleSign() {
            currentInput = (parseFloat(currentInput) * -1).toString();
            updateDisplay();
        }

        function percentage() {
            currentInput = (parseFloat(currentInput) / 100).toString();
            updateDisplay();
        }

        function setOp(op) {
            if (operation !== null) calculate();
            previousInput = currentInput;
            operation = op;
            shouldResetDisplay = true;
            
            let displayOp = op;
            if(op === '/') displayOp = '÷';
            if(op === '*') displayOp = '×';
            
            historyEl.innerText = `${previousInput} ${displayOp}`;
        }

        function calculate() {
            if (operation === null || shouldResetDisplay) return;
            
            let result;
            const prev = parseFloat(previousInput);
            const current = parseFloat(currentInput);

            if (isNaN(prev) || isNaN(current)) return;

            switch (operation) {
                case '+': result = prev + current; break;
                case '-': result = prev - current; break;
                case '*': result = prev * current; break;
                case '/': 
                    if(current === 0) {
                        alert("Cannot divide by zero");
                        clearDisplay();
                        return;
                    }
                    result = prev / current; 
                    break;
                default: return;
            }

            currentInput = result.toString();
            operation = null;
            historyEl.innerText = '';
            shouldResetDisplay = true;
            updateDisplay();
        }
    </script>
</body>
</html>
